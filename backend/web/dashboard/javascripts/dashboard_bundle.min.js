function removeImage(e){jQuery.post(e.attr("data-link"),function(){return jQuery("#image_"+e.attr("data-id")).remove()})}var DASHBOARD=DASHBOARD||{};DASHBOARD.namespace=function(e){var t,a=e.split("."),r=DASHBOARD;for("DASHBOARD"===a[0]&&(a=a.slice(1)),t=0;t<a.length;t+=1)"undefined"==typeof r[a[t]]&&(r[a[t]]={}),r=r[a[t]];return r},DASHBOARD.namespace("DASHBOARD.form_builder"),DASHBOARD.form_builder=function(){return{option:function(e){return'<input type="text" class="option" value="'+e+'">'},create_options:function(e){var t="";if(e)for(var a in e)t+=this.option(e[a].value);return t},template:function(e,t,a,r,n,i){n=n?"checked":"",i=i?this.create_options(i):'<input type="text" class="option" value="">';var o=['<div class="box" data-type="'+e+'"><span class="label label-black" title="Удалить">[x]</span>','<span class="name">'+this.types(e)+"</span>","<label>Метка</label>",'<input type="text" value="'+t+'" class="labelName"/>',"<label>Placeholder</label>",'<input type="text" value="'+r+'" class="placeholder"/>',"<label>css-класс</label>",'<input type="text" class="className" value="'+a+'">',"<label>Обязательное поле?</label>",'<input type="checkbox" class="required" '+n+">"];return"select"==e||"checkbox"==e||"radio"==e?o.push("<div>Варианты опций:</div>",'<div class="fields">',i,"</div>",'<button class="btn btn-xs btn-default">Добавить</button><button class="btn btn-xs btn-red">Удалить</button>','<div class="clearfix"></div>',"</div>"):o.push('<div class="clearfix"></div>',"</div>"),o.join("")},types:function(e){var t={input:"Тип - «input»",select:"Тип - «select»",checkbox:"Тип - «checkbox»",radio:"Тип - «radio»",textarea:"Тип - «textarea»"};return t[e]},json_schema:function(e){var t={};return e.find(".box").each(function(e){var a=jQuery(this),r="field_"+e;t[r]={},t[r]={type:a.attr("data-type"),label:a.find(".labelName").val(),required:a.find(".required").prop("checked"),className:a.find(".className").val(),placeholder:a.find(".placeholder").val()},a.find(".fields").length&&(t[r].options={},a.find(".fields input").each(function(e){var a="option_"+e;t[r].options[a]={value:jQuery(this).val()}}))}),JSON.stringify(t)}}}(),DASHBOARD.namespace("DASHBOARD.transliterate"),DASHBOARD.transliterate=function(){return{start:function(e){var t="-";e=e.toLowerCase();var a={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"y","ы":"y","ь":"y","э":"e","ю":"yu","я":"ya"," ":t,_:t,"`":t,"~":t,"!":t,"@":t,"#":t,$:t,"%":t,"^":t,"&":t,"*":t,"(":t,")":t,"-":t,"=":t,"+":t,"[":t,"]":t,"\\":t,"|":t,"/":t,".":t,",":t,"{":t,"}":t,"'":t,'"':t,";":t,":":t,"?":t,"<":t,">":t,"№":t},r="",n="",i=0;for(i;i<e.length;i++)void 0!=a[e[i]]?(n!=a[e[i]]||n!=t)&&(r+=a[e[i]],n=a[e[i]]):(r+=e[i],n=e[i]);return r=r.replace(/^-/,""),r.replace(/-$/,"")}}}(),jQuery(function(){var e=jQuery("#form"),t=e.serialize();jQuery("#return").on("click",function(){return e.serialize()!==t?confirm("Вы внесли изменения, но не сохранили, вернуться к списку?"):void 0});var a=DASHBOARD.transliterate,r=jQuery("#transliterate__input"),n=jQuery(".box-content");n.on("click",".icon-refresh",function(){var e=a.start(r.val());return jQuery(this).prev("input").val(e)}),"function"==typeof jQuery("textarea").ckeditor&&jQuery("textarea").not("textarea.off_ckeditor").ckeditor();var i=jQuery("#remove_image, #remove_image2"),o=window.location.pathname.replace("update","remove-image");i.on("click",function(){if(confirm("Вы уверены, что хотите удалить изображение?")){var e=jQuery(this),t=e.closest(".thumbnail").find("img");return $.ajax({url:o,type:"POST",data:{imgId:t.attr("data-id")},success:function(){return e.closest("div.thumbnail").fadeOut()&&Growl.info({title:"Уведомление!",text:"Изображение успешно удалено"})}})}});var l=jQuery("#form_builder"),u=jQuery("#form_build"),s=jQuery("#save_form"),c=jQuery("#json_schema");if(l.on("click","button",function(e){e.preventDefault();var t=jQuery(this).attr("data-action");return u.append(DASHBOARD.form_builder.template(t,"","","",""))}),u.on("click",".label-black",function(){return jQuery(this).parent("div.box").remove()}),u.on("click",".btn",function(e){e.preventDefault(),jQuery(this).hasClass("btn-red")?jQuery(this).closest(".box").find(".fields input:last-child").remove():jQuery(this).closest(".box").find(".fields").append(DASHBOARD.form_builder.option(""))}),s.on("click",function(){return jQuery("#json_schema").val(DASHBOARD.form_builder.json_schema(u))}),"undefined"!=typeof c.val()&&c.val().length){c=JSON.parse(c.val());for(var d in c){var f=c[d].type,p=c[d].label,v=c[d].className,h=c[d].placeholder||"",y=c[d].required,m=c[d].options;u.append(DASHBOARD.form_builder.template(f,p,v,h,y,m))}}var b=jQuery(".navigation_box"),j=jQuery("#menuitems-link"),Q=jQuery(".field-menuitems-options");b.on("click",".icon-link",function(){return Q.show()}),Q.on("change","select",function(){return j.val(jQuery(this).val())}),j.on("blur",function(){var e=jQuery(this).val();return"/"!=e[0]?jQuery(this).val("/"+e.replace("index","")):jQuery(this).val(e.replace("index",""))}),$("#thumbs > ul").sortable({stop:function(e,t){var a=[];jQuery(this).find("a").each(function(e){a[e]=jQuery(this).attr("data-id")});var r=window.location.pathname.split("/");$.post("/_root/"+r[2]+"/update-positions",{values:a},function(){Growl.info({title:"Уведомление",text:"Порядок отображения изменён успешно!"})})}});var k=jQuery("#edit-image"),x=jQuery("#image_box");x.on("click","#thumbs .icon-edit",function(){$.post(jQuery(this).attr("data-link"),function(e){return k.html(e)})}),x.on("click",".icon-remove",function(){var e=jQuery(this);return confirm("Вы уверены, что хотите удалить?")?removeImage(e):void 0}),k.on("click","#edit_image_button",function(e){return e.preventDefault(),jQuery.ajax({url:jQuery(this).closest("form").attr("action"),type:"POST",dataType:"json",data:jQuery(this).closest("form").serialize(),success:function(e){return k.modal("hide"),Growl.info({title:"Сообщение из конторы",text:"Информация об изображении сохранена успешно"}),x.html(e)}})});var _=jQuery("#group__actions"),D=jQuery(".galleries__list"),A=jQuery(".btn_action"),g=[],O=jQuery(".box__galleries_list");_.on("change",function(e){e.preventDefault();var t=jQuery(this);switch(t.val()){case"check_all":x.find(":checkbox").attr("checked",!0);break;case"copy-checked":D.removeClass("hidden"),A.removeClass("hidden");break;case"move-checked":D.removeClass("hidden"),A.removeClass("hidden");break;case"remove-checked":A.removeClass("hidden")}}),O.on("click","button",function(e){e.preventDefault(),g=[],x.find("input:checked").each(function(){return g.push(parseInt(jQuery(this).attr("data-id")))}),g.length&&jQuery.post(window.location.pathname.replace("update",_.val()),{data:g,gallery_to:parseInt(jQuery(".gallery_id").val())},function(e){return x.html(e),Growl.info({title:"Сообщение из конторы",text:"Действие выполнено успешно!"})})});var w=jQuery(".table-sortable tbody");w.sortable({revert:!0,items:"tr",cursor:"move",opacity:".5",handle:".icon-move",stop:function(e,t){jQuery.post(window.location.pathname+"/update-pos",{data:w.sortable("toArray")},function(){return w.find("tr").each(function(e){return jQuery(this).find("input").val(e)}),Growl.info({title:"Сообщение из конторы",text:"Порядок сохранён успешно!"})})}});var S=jQuery("#reviews .actions");S.on("click","i",function(){var e=jQuery(this);if(-1!=e.attr("data-link").indexOf("remove")){if(confirm("Вы уверены, что хотите удалить?"))return removeImage(e)&&Growl.info({title:"Сообщение из конторы",text:"Изображение удалено успешно"})}else jQuery.post(e.attr("data-link"),function(e){return k.html(e)})});var B=jQuery(".primary-sidebar li > a"),H=window.location.pathname.replace(/\/add|\/delete\/(\d+)|\/product\/list\/(\d+)|\/product\/list\/(\d+)|\/delete-item\/(\d+)|\/edit-item\/(\d+)|\/items\/(\d+)|\/update\/(\d+)/g,"");B.each(function(){return jQuery(this).attr("href")==H?jQuery(this).closest(".dark-nav").addClass("active")&&jQuery(this).closest(".dark-nav > ul").addClass("in")&&jQuery(this).parent("li").addClass("active"):void 0})});